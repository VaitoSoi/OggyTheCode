const { Interaction, MessageEmbed, MessageActionRow, MessageButton, MessageSelectMenu } = require('discord.js')
const { QueueRepeatMode } = require('discord-player')
const ms = require('ms')

module.exports = {
    name: 'interactionCreate',
    /**
     * 
     * @param {Interaction} interaction 
     * @returns 
     */
    async run(interaction) {
        const { player } = require('../index')
        const client = interaction.client
        if (!interaction.guildId) return
        const queue = player.getQueue(interaction.guildId)

        // N·∫øu interaction l√† n√∫t

        if (interaction.isButton()) {

            /**
             * 
             * v H√†ng ch·ªù nh·∫°c
             * 
             */

            if (interaction.customId === 'queuenextpage') {
                const last = interaction.message.embeds[0].fields[Number(interaction.message.embeds[0].fields.length) - 1].name.split(' ')[0]
                if (!last) return
                const i0 = Number(last)
                const i = i0 + 1
                const i2 = i + 10
                if (!queue) return
                var row = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuepreviouspage')
                            .setLabel('<<<')
                            .setStyle('SUCCESS')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuedeletemessage')
                            .setLabel('üóëÔ∏è')
                            .setStyle('DANGER')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuenextpage')
                            .setLabel('>>>')
                            .setStyle('SUCCESS')
                    )
                if (Number(i2) >= queue.tracks.length) {
                    row = new MessageActionRow()
                        .addComponents(
                            new MessageButton()
                                .setCustomId('queuepreviouspage')
                                .setLabel('<<<')
                                .setStyle('SUCCESS')
                        )
                        .addComponents(
                            new MessageButton()
                                .setCustomId('queuedeletemessage')
                                .setLabel('üóëÔ∏è')
                                .setStyle('DANGER')
                        )
                        .addComponents(
                            new MessageButton()
                                .setCustomId('queuenextpage')
                                .setLabel('>>>')
                                .setStyle('SUCCESS')
                                .setDisabled()
                        )
                }
                const embed = new MessageEmbed()
                    .setTitle(`C√°c b√†i h√°t trong queue t·∫°i server **${interaction.message.guild.name}**`)
                    .setFooter({
                        text: `T·∫•t c·∫£ b√†i h√°t: ${queue.tracks.length} | T·ªïng c·ªông th·ªùi gian: ${ms(queue.totalTime)}`
                    })
                    .setAuthor({
                        name: `${interaction.user.tag}`,
                        iconURL: interaction.user.displayAvatarURL()
                    })
                    .addFields({
                        name: 'B√†i h√°t ƒëang ph√°t',
                        value: `${queue.current.title}\nLink: ${queue.current.url}\nB·ªüi: ${queue.current.author} | Th·ªùi gian: ${ms(queue.current.durationMS)}\nNg∆∞·ªùi y√™u c·∫ßu: ${queue.current.requestedBy}`
                    })
                    .setColor('RANDOM')
                var n = i
                const queue1 = queue.tracks.slice(i, i2)
                queue1.forEach(track => {
                    embed.addFields({
                        name: `${n} ${track.title}`,
                        value: `Link: ${track.url}\nB·ªüi: ${track.author} | Th·ªùi gian: ${ms(track.durationMS)}\nNg∆∞·ªùi y√™u c·∫ßu: ${track.requestedBy}`
                    })
                    n++
                })
                interaction.update({ embeds: [embed], components: [row] })

            } else if (interaction.customId === 'queuepreviouspage') {
                const first = interaction.message.embeds[0].fields[2].name.split(' ')[0]
                if (!first) return
                const i0 = Number(first)
                var i = i0 - 11
                if (i < 0) i = 0
                const i2 = Number(i) + 10
                if (!queue) return
                var row = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuepreviouspage')
                            .setLabel('<<<')
                            .setStyle('SUCCESS')
                            .setDisabled()
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuedeletemessage')
                            .setLabel('üóëÔ∏è')
                            .setStyle('DANGER')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuenextpage')
                            .setLabel('>>>')
                            .setStyle('SUCCESS')
                    )
                if (Number(i0) <= 0 || Number(i0) == 1) {
                    row = new MessageActionRow()
                        .addComponents(
                            new MessageButton()
                                .setCustomId('queuepreviouspage')
                                .setLabel('<<<')
                                .setStyle('SUCCESS')
                        ).addComponents(
                            new MessageButton()
                                .setCustomId('queuedeletemessage')
                                .setLabel('üóëÔ∏è')
                                .setStyle('DANGER')
                        )
                        .addComponents(
                            new MessageButton()
                                .setCustomId('queuenextpage')
                                .setLabel('>>>')
                                .setStyle('SUCCESS')
                        )
                }
                const embed = new MessageEmbed()
                    .setTitle(`C√°c b√†i h√°t trong queue t·∫°i server **${interaction.message.guild.name}**`)
                    .setFooter({ text: `T·∫•t c·∫£ b√†i h√°t: ${queue.tracks.length} | T·ªïng c·ªông th·ªùi gian: ${ms(queue.totalTime)}` })
                    .setAuthor({ name: `${interaction.user.tag}`, iconURL: interaction.user.displayAvatarURL() })
                    .addFields({
                        name: 'B√†i h√°t ƒëang ph√°t',
                        value: `\`\`\` ${queue.current.title} \`\`\`\nLink: ${queue.current.url}\nB·ªüi: ${queue.current.author} | Th·ªùi gian: ${ms(queue.current.durationMS)}\nNg∆∞·ªùi y√™u c·∫ßu: ${queue.current.requestedBy}`
                    })
                    .setColor('RANDOM')
                var n = i
                const queue1 = queue.tracks.slice(i, i2)
                queue1.forEach(track => {
                    embed.addFields({
                        name: `${n} ${track.title}`,
                        value: `Link: ${track.url}\nB·ªüi: ${track.author} | Th·ªùi gian: ${ms(track.durationMS)}\nNg∆∞·ªùi y√™u c·∫ßu: ${track.requestedBy}`
                    })
                    n++
                })
                interaction.update({ embeds: [embed], components: [row] })
            } else if (interaction.customId === 'queuedeletemessage') {
                interaction.reply({ content: 'üóë | ƒê√£ x√≥a tin nh·∫Øn.', ephemeral: true })
                return interaction.message.delete()
            }
            /** 
             * ^ H√†ng ch·ªù nh·∫°c
             * 
             * v Tin nh·∫Øn t·ª´ m√°y ph√°t nh·∫°c
             */

            // B√†i h√°t tr∆∞·ªõc

            else if (interaction.customId === 'previousong') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (queue.previousTracks.length == 1) return interaction.reply({
                    content: 'üõë | Kh√¥ng ph√°t hi·ªán b√†i h√°t tr∆∞·ªõc !',
                    ephemeral: true
                })
                queue.back()
                interaction.reply({ content: '‚èÆ | ƒê√£ chuy·ªÉn v·ªÅ b√†i tr∆∞·ªõc.', ephemeral: true })
            }

            // Gi·∫£m √¢m l∆∞·ª£ng

            else if (interaction.customId === 'minimizevolume') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                const volume = Number(queue.volume) - 10
                if (volume < 0) return interaction.reply({ content: 'Kh√¥ng th·ªÉ ch·ªânh volume xu·ªëng th·∫•p h∆°n 0', ephemeral: true })
                queue.setVolume(Number(volume))
                interaction.reply({ content: `üîâ | ƒê√£ ch·ªânh volume th√†nh ${volume}%`, ephemeral: true })
            }

            // Ti·∫øp t·ª•c b√†i h√°t

            else if (interaction.customId === 'playsong') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                queue.setPaused(false)
                const row1 = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('previousong')
                            .setStyle('PRIMARY')
                            .setLabel('‚èÆ')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('minimizevolume')
                            .setStyle('PRIMARY')
                            .setLabel('üîâ')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('pausesong')
                            .setStyle('PRIMARY')
                            .setLabel('‚è∏')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('maximizevolume')
                            .setStyle('PRIMARY')
                            .setLabel('üîä')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('nextsong')
                            .setStyle('PRIMARY')
                            .setLabel('‚è≠')
                    )
                const row2 = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queue')
                            .setStyle('PRIMARY')
                            .setLabel('üìÉ Queue')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('loop')
                            .setStyle('PRIMARY')
                            .setLabel('üîÉ Loop')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('shuffle')
                            .setStyle('PRIMARY')
                            .setLabel('üîÄ Shuffle')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('stop')
                            .setStyle('PRIMARY')
                            .setLabel('üõë Stop')
                    )
                interaction.message.edit({ embeds: [interaction.message.embeds[0]], components: [row1, row2] })
                interaction.reply({ content: '‚ñ∂ | ƒê√£ ti·∫øp t·ª•c b√†i h√°t', ephemeral: true })
            }

            // T·∫°m d·ª´ng b√†i h√°t

            else if (interaction.customId === 'pausesong') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                queue.setPaused(true)
                const row1 = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('previousong')
                            .setStyle('PRIMARY')
                            .setLabel('‚èÆ')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('minimizevolume')
                            .setStyle('PRIMARY')
                            .setLabel('üîâ')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('playsong')
                            .setStyle('PRIMARY')
                            .setLabel('‚ñ∂')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('maximizevolume')
                            .setStyle('PRIMARY')
                            .setLabel('üîä')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('nextsong')
                            .setStyle('PRIMARY')
                            .setLabel('‚è≠')
                    )
                const row2 = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queue')
                            .setStyle('PRIMARY')
                            .setLabel('üìÉ Queue')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('loop')
                            .setStyle('PRIMARY')
                            .setLabel('üîÉ Loop')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('shuffle')
                            .setStyle('PRIMARY')
                            .setLabel('üîÄ Shuffle')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('stop')
                            .setStyle('PRIMARY')
                            .setLabel('üõë Stop')
                    )
                interaction.message.edit({ embeds: [interaction.message.embeds[0]], components: [row1, row2] })
                interaction.reply({ content: '‚è∏ | ƒê√£ d·ª´ng b√†i h√°t.', ephemeral: true })
            }

            // TƒÉng √¢m l∆∞·ª£ng

            else if (interaction.customId === 'maximizevolume') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                const volume = Number(queue.volume) + 10
                if (volume > 100) return interaction.reply({ content: 'Kh√¥ng th·ªÉ ch·ªânh volume l·ªõn h∆°n 100', ephemeral: true })
                queue.setVolume(Number(volume))
                interaction.reply({ content: `üîä | ƒê√£ ch·ªânh volume th√†nh ${volume}%`, ephemeral: true })
            }

            // B·ªè qua b√†i h√°t

            else if (interaction.customId === 'nextsong') {
                if (!queue || !queue.nowPlaying) {
                    interaction.message.delete()
                    return interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                queue.skip()
                interaction.reply({ content: '‚è≠ | ƒê√£ b·ªè qua b√†i h√°t', ephemeral: true })
            }

            // Nh·∫Øn h√†ng ch·ªù

            else if (interaction.customId === 'queue') {
                if (!queue || !queue.nowPlaying) {
                    interaction.message.delete()
                    return interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                const row = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuepreviouspage')
                            .setLabel('<<<')
                            .setStyle('SUCCESS')
                            .setDisabled()
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuedeletemessage')
                            .setLabel('üóëÔ∏è')
                            .setStyle('DANGER')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queuenextpage')
                            .setLabel('>>>')
                            .setStyle('SUCCESS')
                    )
                if (!queue.tracks.length) {
                    const embed = new MessageEmbed()
                        .setColor('GREEN')
                        .setAuthor({ name: `Danh s√°ch b√†i h√°t ƒëang ch·ªù ph√°t t·∫°i ${interaction.message.guild.name}`, iconURL: interaction.message.guild.iconURL({ dynamic: true }) })
                        .addFields({
                            name: `${n} ${queue.current.title}`,
                            value: `Link: ${queue.current.url}\nB·ªüi: ${queue.current.author} | Th·ªùi gian: ${ms(queue.current.durationMS)}\nNg∆∞·ªùi y√™u c·∫ßu: ${queue.current.requestedBy}`
                        });
                    return interaction.reply({ embeds: [embed] })
                }

                const embed = new MessageEmbed()
                    .setTitle(`C√°c b√†i h√°t trong queue t·∫°i server **${interaction.message.guild.name}**`)
                    .setFooter({ text: `T·∫•t c·∫£ b√†i h√°t: ${queue.tracks.length} | T·ªïng c·ªông th·ªùi gian: ${ms(queue.totalTime)}` })
                    .setAuthor({ name: `${interaction.user.tag}`, iconURL: interaction.user.displayAvatarURL() })
                    .addFields({
                        name: 'B√†i h√°t ƒëang ph√°t',
                        value: `${queue.current.title}\nLink: ${queue.current.url}\nB·ªüi: ${queue.current.author} | Th·ªùi gian: ${ms(queue.current.durationMS)}\nNg∆∞·ªùi y√™u c·∫ßu: ${queue.current.requestedBy}`
                    })
                    .setColor('RANDOM')
                var n = 0
                const queue1 = queue.tracks.slice(0, 10)
                queue1.forEach(track => {
                    n++
                    embed.addFields({
                        name: `${n} ${track.title}`,
                        value: `Link: ${track.url}\nB·ªüi: ${track.author} | Th·ªùi gian: ${ms(track.durationMS)}\nNg∆∞·ªùi y√™u c·∫ßu: ${track.requestedBy}`
                    })
                })
                interaction.reply({ embeds: [embed], components: [row] })
            }

            // L·∫∑p l·∫°i b√†i h√°t, h√†ng ch·ªù,v.v..

            else if (interaction.customId === 'loop') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                const row = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('loopoff')
                            .setStyle('PRIMARY')
                            .setLabel('OFF')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('looptrack')
                            .setStyle('PRIMARY')
                            .setLabel('TRACK')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('loopqueue')
                            .setStyle('PRIMARY')
                            .setLabel('QUEUE')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('loopautoplay')
                            .setStyle('PRIMARY')
                            .setLabel('AUTOPLAY')
                    )
                interaction.reply({ embeds: [new MessageEmbed().setTitle('Vui l√≤ng ch·ªçn 1 t√πy ch·ªçn ph√≠a d∆∞·ªõi !')], components: [row], ephemeral: true })
            }

            // X√°o tr·ªôn h√†ng ch·ªù

            else if (interaction.customId === 'shuffle') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                queue.shuffle()
                const row1 = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('previousong')
                            .setStyle('PRIMARY')
                            .setLabel('‚èÆ')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('minimizevolume')
                            .setStyle('PRIMARY')
                            .setLabel('üîâ')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('pausesong')
                            .setStyle('PRIMARY')
                            .setLabel('‚è∏')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('maximizevolume')
                            .setStyle('PRIMARY')
                            .setLabel('üîä')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('nextsong')
                            .setStyle('PRIMARY')
                            .setLabel('‚è≠')
                    )
                const row2 = new MessageActionRow()
                    .addComponents(
                        new MessageButton()
                            .setCustomId('queue')
                            .setStyle('PRIMARY')
                            .setLabel('üìÉ Queue')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('loop')
                            .setStyle('PRIMARY')
                            .setLabel('üîÉ Loop')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('shuffle')
                            .setStyle('PRIMARY')
                            .setLabel('üîÄ Shuffle')
                    )
                    .addComponents(
                        new MessageButton()
                            .setCustomId('stop')
                            .setStyle('PRIMARY')
                            .setLabel('üõë Stop')
                    )
                let arrayOfOption = []
                let num = 0
                queue.tracks.forEach((t) => {
                    num++
                    if (num >= 26) return;
                    let name = ''
                    if (t.title.split(' ').length > 15) {
                        let num2 = 0
                        t.title.split(' ').forEach((n) => {
                            if (num2 > 15 || name.split('') > 90) {
                                return
                            } else {
                                name = name + ' ' + t.title.split(' ')[num2]
                                num2++
                            }
                        })
                    } else name = t.title
                    arrayOfOption.push({
                        label: `${num}. ${name}...`,
                        value: `${num}`
                    })
                })
                const row3 = new MessageActionRow()
                    .addComponents(
                        new MessageSelectMenu()
                            .setCustomId('skiptomenu')
                            .setPlaceholder('C√°c b√†i h√°t trong h√†ng ch·ªù')
                            .setDisabled(false)
                            .addOptions(arrayOfOption)
                    )
                interaction.message.edit({
                    embeds: interaction.message.embeds,
                    components: [
                        row1,
                        row2,
                        row3
                    ]
                })
                interaction.reply({ content: 'üîÄ | ƒê√£ x√°o tr·ªôn h√†ng ch·ªù.', ephemeral: true })
            }

            // D·ª´ng ph√°t nh·∫°c

            else if (interaction.customId === 'stop') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                queue.destroy()
                interaction.reply({ content: '‚èπ | ƒê√£ d·ª´ng ph√°t nh·∫°c', ephemeral: true })
            }

            /**
             * ^ Tin nh·∫Øn t·ª´ m√°y ph√°t nh·∫°c
             * 
             * v Lo·∫°i l·∫∑p h√†ng ch·ªù
             */

            // T·∫Øt

            else if (interaction.customId === 'loopoff') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                const loopmode = 0
                const success = queue.setRepeatMode(loopmode);
                const mode = loopmode === QueueRepeatMode.TRACK ? "üîÇ" : loopmode === QueueRepeatMode.QUEUE ? "üîÅ" : "‚ñ∂";
                interaction.reply({ content: success ? `${mode} | C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô l·∫∑p l·∫°i!` : "‚ùå | X·∫£y ra l·ªói!", ephemeral: true })
            }

            // B√†i h√°t

            else if (interaction.customId === 'looptrack') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                const loopmode = 1
                const success = queue.setRepeatMode(loopmode);
                const mode = loopmode === QueueRepeatMode.TRACK ? "üîÇ" : loopmode === QueueRepeatMode.QUEUE ? "üîÅ" : "‚ñ∂";
                interaction.reply({ content: success ? `${mode} | C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô l·∫∑p l·∫°i!` : "‚ùå | X·∫£y ra l·ªói!", ephemeral: true })
            }

            // H√†ng ch·ªù

            else if (interaction.customId === 'loopqueue') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                const loopmode = 2
                const success = queue.setRepeatMode(loopmode);
                const mode = loopmode === QueueRepeatMode.TRACK ? "üîÇ" : loopmode === QueueRepeatMode.QUEUE ? "üîÅ" : "‚ñ∂";
                interaction.reply({ content: success ? `${mode} | C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô l·∫∑p l·∫°i!` : "‚ùå | X·∫£y ra l·ªói!", ephemeral: true })
            }

            // T·ª± ph√°t nh·∫°c

            else if (interaction.customId === 'loopautoplay') {
                if (!queue || !queue.nowPlaying) {
                    interaction.reply({ content: '‚ùå | Kh√¥ng ph√°t hi·ªán h√†ng ch·ªù !', ephemeral: true })
                    return interaction.message.delete()
                }
                if (!interaction.member.voice.channel) return interaction.reply({
                    content: 'üõë | Vui l√≤ng k·∫øt n·ªëi ƒë·∫øn Voice Channel ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                if (!interaction.guild.me.voice.channelId || interaction.guild.me.voice.channelId !== interaction.member.voice.channel.id) return interaction.reply({
                    content: 'üõë | Vui l√≤ng v√¥ chung Voice Channel v·ªõi bot ƒë·ªÉ d√πng l·ªánh.',
                    ephemeral: true
                })
                const loopmode = 3
                const success = queue.setRepeatMode(loopmode);
                const mode = loopmode === QueueRepeatMode.TRACK ? "üîÇ" : loopmode === QueueRepeatMode.QUEUE ? "üîÅ" : "‚ñ∂";
                interaction.reply({ content: success ? `${mode} | C·∫≠p nh·∫≠t ch·∫ø ƒë·ªô l·∫∑p l·∫°i!` : "‚ùå | X·∫£y ra l·ªói!", ephemeral: true })
            }
        }

        // N·∫øu interaction l√† Slash command
        else if (interaction.isCommand()) {
            const data = await require('../models/blacklist').findOne({ id: interaction.user.id })
            let ava = Boolean;
            // if (!interaction.command) return interaction.reply('[üõë] | ERROR: `INTERACTION.COMMAND is underfined`')
            const command = client.interactions.get(interaction.commandName)
            if (!command) return interaction.reply('[üõë] | ERROR: `COMMAND is underfined`')
            if (!data) {
                client.channels.cache.get(process.env.LOG_CHANNEL).send({
                    embeds: [
                        new MessageEmbed()
                            .setTitle('ƒê√£ c√≥ 1 l·ªánh ƒë∆∞·ª£c th·ª±c thi')
                            .addFields({
                                name: 'L·ªánh:',
                                value: `T√™n: ${command.data.name}\n`
                            },
                                {
                                    name: 'Ng∆∞·ªùi ra l·ªánh:',
                                    value: `T√™n: ${interaction.user.tag}\nID: ${interaction.user.id}`
                                },
                                {
                                    name: 'T·∫°i:',
                                    value: `T√™n: ${interaction.guild.name}\nID: ${interaction.guildId}`
                                })
                            .setColor('RANDOM')
                            .setAuthor({
                                name: `${client.user.tag}`,
                                iconURL: client.user.avatarURL()
                            })
                            .setFooter({
                                text: `${interaction.guild.name}`,
                                iconURL: interaction.guild.iconURL()
                            })
                            .setTimestamp()
                    ]
                })

                const data2 = await require('../models/commands').findOne({ guildid: interaction.guildId })
                if (data2) {
                    const ar = data2.commands
                    if (ar.includes(command.name)) { ava = false } else { ava = true }
                } else {
                    ava = true
                }


                if (ava === false) {
                    interaction.reply({
                        embeds: [
                            new MessageEmbed()
                                .setTitle(`‚ùå | L·ªánh \`${cmd}\` ƒë√£ b·ªã t·∫Øt b·ªüi Admin`)
                                .setColor('#f00c0c')
                        ]
                    })

                } else if (ava === true || !ava) {
                    if (command) {
                        if (command.category === 'music' && !interaction.member.voice.channel) return interaction.channel.send('V√¥ voice channel ƒëi t m·ªõi m·ªü cho mi nghe ƒëc ch·ª©')
                        try {
                            command.run(interaction);
                        } catch (err) {
                            interaction.reply('ƒê√£ x·∫£y ra l·ªói khi th·ª±c thi l·ªánh!\nL·ªói:```' + err + '```')
                            /*
                            client.channels.cache.get('930786044692008960').send({
                                embeds: [
                                    new MessageEmbed()
                                        .setTitle(`Ph√°t hi·ªán l·ªói khi th·ª±c thi l·ªánh!`)
                                        .addFields({
                                            name: 'L·ªánh:',
                                            value: `${command.name}`
                                        },
                                            {
                                                name: 'Ng∆∞·ªùi ra l·ªánh:',
                                                value: `${interaction.author}`
                                            },
                                            {
                                                name: 'L·ªói:',
                                                value: '```' + `${err}` + '```' + '\nL·ªói ƒë√£ ƒë∆∞·ª£c th√¥ng b√°o t·ªõi console!'
                                            })
                                ]
                            })
                            console.log(err) */
                        }
                    }
                }
            } else {
                var by = data.by
                if (!by || !data.by) by = 'VaitoSoi#2220'
                interaction.reply({
                    embeds: [new MessageEmbed()
                        .setTitle('B·∫°n ƒë√£ b·ªã blacklist t·ª´ tr∆∞·ªõc.')
                        .addFields({
                            name: 'UserID:',
                            value: `${data.id}`,
                            inline: true
                        },
                            {
                                name: 'B·ªüi:',
                                value: `${by}`,
                                inline: true
                            },
                            {
                                name: 'L√Ω do',
                                value: `${data.reason}`,
                                inline: false
                            })
                        .setAuthor({ name: `${client.user.tag} blacklist`, iconURL: client.user.avatarURL() })
                        .setFooter({ text: `${interaction.user.tag} ‚Ä¢ L·ªánh: ${interaction.command.name ? interaction.command.name : 'underfined'}` })
                        .setColor('RANDOM')
                        .setThumbnail(interaction.user.displayAvatarURL())
                        .setTimestamp()
                    ]
                })
            }
        }
    }
}